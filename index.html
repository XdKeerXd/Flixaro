<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flixaro | Stream Movies & TV Shows</title>
    <meta name="description" content="Flixaro - Premium streaming by Ahmed Jaballah">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e50914">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé¨</text></svg>">
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Cairo:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0a;
            --bg2: #141414;
            --bg3: #1c1c1c;
            --card: #1a1a1a;
            --glass: rgba(20, 20, 20, 0.95);
            --border: rgba(255, 255, 255, 0.08);
            --red: #e50914;
            --red2: #b20710;
            --text: #fff;
            --text2: #b3b3b3;
            --text3: #666;
            --yellow: #f5c518;
            --green: #46d369;
            --purple: #9b59b6;
            --blue: #3498db;
            --trans: .3s cubic-bezier(.4, 0, .2, 1);
            --font: 'Poppins', sans-serif
        }

        [dir="rtl"] {
            --font: 'Cairo', sans-serif
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        html {
            scroll-behavior: smooth
        }

        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px
        }

        ::-webkit-scrollbar-track {
            background: var(--bg2)
        }

        ::-webkit-scrollbar-thumb {
            background: var(--red);
            border-radius: 4px
        }

        a {
            color: inherit;
            text-decoration: none
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 16px 48px;
            display: flex;
            align-items: center;
            gap: 40px;
            background: linear-gradient(180deg, rgba(0, 0, 0, .9) 0%, transparent 100%);
            transition: all var(--trans)
        }

        .header.scrolled {
            background: var(--bg);
            padding: 12px 48px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, .5)
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--red)
        }

        .logo-icon {
            font-size: 1.8rem
        }

        .nav {
            display: flex;
            gap: 32px;
            flex: 1
        }

        .nav a {
            color: var(--text2);
            font-size: .95rem;
            font-weight: 500;
            transition: all var(--trans);
            position: relative;
            padding: 4px 0
        }

        .nav a:hover,
        .nav a.active {
            color: var(--text)
        }

        .nav a.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--red);
            border-radius: 2px;
            animation: slideIn .3s ease
        }

        @keyframes slideIn {
            from {
                width: 0
            }

            to {
                width: 100%
            }
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px
        }

        /* RTL Support */
        [dir="rtl"] .header-right {
            margin-right: auto;
            margin-left: 0
        }

        [dir="rtl"] .nav {
            margin-right: 40px
        }

        [dir="rtl"] .search-icon {
            margin-left: 10px;
            margin-right: 0
        }

        [dir="rtl"] .card-play {
            transform: translate(50%, -50%) scale(0)
        }

        [dir="rtl"] .card:hover .card-play {
            transform: translate(50%, -50%) scale(1)
        }

        [dir="rtl"] .toast {
            border-left: none;
            border-right: 4px solid var(--green)
        }

        /* Search */
        .search-wrapper {
            position: relative
        }

        .search-box {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 30px;
            padding: 0 16px;
            transition: all var(--trans);
            overflow: hidden
        }

        .search-box:focus-within {
            background: var(--bg2);
            border-color: var(--red);
            box-shadow: 0 0 20px rgba(229, 9, 20, 0.2)
        }

        .search-box input {
            width: 180px;
            padding: 10px 0;
            background: transparent;
            border: none;
            color: var(--text);
            font-size: .9rem;
            outline: none;
            transition: width var(--trans)
        }

        .search-box:focus-within input {
            width: 260px
        }

        .search-box input::placeholder {
            color: var(--text3)
        }

        .search-icon {
            color: var(--text2);
            font-size: 1.1rem;
            margin-right: 10px
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 8px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            animation: fadeDown .3s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, .5);
            z-index: 101
        }

        .search-results.active {
            display: block
        }

        @keyframes fadeDown {
            from {
                opacity: 0;
                transform: translateY(-10px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .search-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: background var(--trans)
        }

        .search-item:hover {
            background: rgba(255, 255, 255, 0.05)
        }

        .search-item img {
            width: 45px;
            height: 65px;
            object-fit: cover;
            border-radius: 6px
        }

        .search-item-info h4 {
            font-size: .9rem;
            font-weight: 500
        }

        .search-item-info p {
            font-size: .75rem;
            color: var(--text3)
        }

        /* Buttons */
        .icon-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text2);
            cursor: pointer;
            transition: all var(--trans);
            font-size: 1.1rem
        }

        .icon-btn:hover {
            color: var(--text);
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.1)
        }

        .user-btn {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--red), var(--red2));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: transform var(--trans)
        }

        .user-btn:hover {
            transform: scale(1.1)
        }

        .user-btn img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px
        }

        .user-menu {
            position: absolute;
            top: calc(100% + 12px);
            right: 0;
            width: 220px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 8px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all var(--trans);
            box-shadow: 0 10px 40px rgba(0, 0, 0, .5)
        }

        [dir="rtl"] .user-menu {
            right: auto;
            left: 0
        }

        .user-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0)
        }

        .user-menu-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 8px
        }

        .user-menu-header h4 {
            font-size: .95rem;
            font-weight: 600
        }

        .user-menu-header p {
            font-size: .8rem;
            color: var(--text3)
        }

        .user-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: .9rem;
            color: var(--text2);
            cursor: pointer;
            transition: all var(--trans)
        }

        .user-menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text)
        }

        .user-menu-item.logout {
            color: var(--red)
        }

        /* Hero */
        .hero {
            position: relative;
            height: 90vh;
            min-height: 600px;
            overflow: hidden
        }

        .hero-bg {
            position: absolute;
            inset: 0
        }

        .hero-slide {
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 1.5s ease
        }

        .hero-slide.active {
            opacity: 1
        }

        .hero-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, rgba(0, 0, 0, .95) 0%, rgba(0, 0, 0, .6) 40%, rgba(0, 0, 0, .2) 70%, transparent 100%), linear-gradient(0deg, var(--bg) 0%, transparent 30%)
        }

        .hero-content {
            position: absolute;
            bottom: 18%;
            left: 48px;
            max-width: 550px;
            z-index: 10
        }

        [dir="rtl"] .hero-content {
            left: auto;
            right: 48px
        }

        [dir="rtl"] .hero-overlay {
            background: linear-gradient(270deg, rgba(0, 0, 0, .95) 0%, rgba(0, 0, 0, .6) 40%, rgba(0, 0, 0, .2) 70%, transparent 100%), linear-gradient(0deg, var(--bg) 0%, transparent 30%)
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: rgba(229, 9, 20, 0.2);
            border: 1px solid var(--red);
            border-radius: 20px;
            font-size: .8rem;
            color: var(--red);
            margin-bottom: 16px;
            animation: pulse 2s infinite
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: .7
            }
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 16px;
            text-shadow: 0 4px 30px rgba(0, 0, 0, .5);
            animation: fadeUp .8s ease
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(30px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .hero-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            animation: fadeUp .8s ease .1s backwards
        }

        .hero-rating {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--yellow);
            font-weight: 600;
            font-size: 1rem
        }

        .hero-rating span {
            font-size: 1.1rem
        }

        .meta-tag {
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            font-size: .85rem;
            color: var(--text2)
        }

        .hero-genres {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            animation: fadeUp .8s ease .2s backwards
        }

        .genre-tag {
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            font-size: .8rem;
            transition: all var(--trans)
        }

        .hero-desc {
            color: var(--text2);
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 24px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            animation: fadeUp .8s ease .3s backwards
        }

        .hero-btns {
            display: flex;
            gap: 12px;
            align-items: center;
            animation: fadeUp .8s ease .4s backwards
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            border-radius: 8px;
            font-weight: 600;
            font-size: .95rem;
            cursor: pointer;
            transition: all var(--trans);
            border: none;
            position: relative;
            overflow: hidden
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width .5s, height .5s
        }

        .btn:hover::before {
            width: 300px;
            height: 300px
        }

        .btn-primary {
            background: #fff;
            color: #000
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.2)
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            backdrop-filter: blur(10px)
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px)
        }

        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3)
        }

        .btn-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #fff;
            transform: scale(1.1)
        }

        .hero-dots {
            position: absolute;
            bottom: 8%;
            left: 48px;
            display: flex;
            gap: 10px;
            z-index: 10
        }

        [dir="rtl"] .hero-dots {
            left: auto;
            right: 48px
        }

        .hero-dot {
            width: 12px;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer;
            transition: all var(--trans)
        }

        .hero-dot.active {
            background: var(--red);
            transform: scale(1.2)
        }

        /* Main Content */
        .main {
            padding: 0 48px 80px;
            margin-top: -80px;
            position: relative;
            z-index: 10
        }

        .section {
            margin-bottom: 48px;
            animation: fadeUp .6s ease
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px
        }

        .section-title::before {
            content: '';
            width: 5px;
            height: 24px;
            background: linear-gradient(180deg, var(--red), var(--red2));
            border-radius: 3px
        }

        .section-title .emoji {
            font-size: 1.3rem
        }

        .see-all {
            color: var(--text2);
            font-size: .9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color var(--trans)
        }

        .see-all:hover {
            color: var(--red)
        }

        /* Cards Row */
        .row {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding: 8px 0;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth
        }

        .row::-webkit-scrollbar {
            height: 0
        }

        .card {
            flex: 0 0 200px;
            scroll-snap-align: start;
            background: var(--card);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all var(--trans);
            position: relative
        }

        .card:hover {
            transform: translateY(-10px) scale(1.02);
            z-index: 5;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .5)
        }

        .card-img {
            aspect-ratio: 2/3;
            position: relative;
            overflow: hidden
        }

        .card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform .5s ease
        }

        .card:hover .card-img img {
            transform: scale(1.1)
        }

        .card-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(transparent 40%, rgba(0, 0, 0, .95));
            opacity: 0;
            transition: opacity var(--trans);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 16px
        }

        .card:hover .card-overlay {
            opacity: 1
        }

        .card-play {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 56px;
            height: 56px;
            background: var(--red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--trans);
            box-shadow: 0 8px 25px rgba(229, 9, 20, .5);
            font-size: 1.3rem
        }

        .card:hover .card-play {
            transform: translate(-50%, -50%) scale(1)
        }

        .card-rating {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, .8);
            backdrop-filter: blur(10px);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: .75rem;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 2
        }

        [dir="rtl"] .card-rating {
            left: auto;
            right: 10px
        }

        .card-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--red);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: .65rem;
            font-weight: 700;
            z-index: 2
        }

        [dir="rtl"] .card-badge {
            right: auto;
            left: 10px
        }

        .card-badge.anime {
            background: var(--purple)
        }

        .card-info {
            padding: 14px
        }

        .card-title {
            font-size: .9rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px
        }

        .card-meta {
            font-size: .8rem;
            color: var(--text3);
            display: flex;
            align-items: center;
            gap: 8px
        }

        /* Wide Cards */
        .wide-card {
            flex: 0 0 320px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all var(--trans)
        }

        .wide-card:hover {
            transform: scale(1.03);
            box-shadow: 0 15px 40px rgba(0, 0, 0, .5)
        }

        .wide-card img {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover
        }

        .wide-card .progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.2)
        }

        .wide-card .progress-bar {
            height: 100%;
            background: var(--red);
            border-radius: 0 2px 2px 0
        }

        .wide-card .play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, .95);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #000;
            opacity: 0;
            transition: all var(--trans)
        }

        .wide-card:hover .play-btn {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.1)
        }

        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .92);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px)
        }

        .modal.active {
            display: flex;
            animation: fadeIn .3s ease
        }

        @keyframes fadeIn {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--trans);
            z-index: 10;
            font-size: 1.2rem
        }

        [dir="rtl"] .modal-close {
            right: auto;
            left: 20px
        }

        .modal-close:hover {
            background: var(--red);
            transform: rotate(90deg)
        }

        .modal-box {
            width: 100%;
            max-width: 950px;
            background: var(--bg2);
            border-radius: 16px;
            overflow: hidden;
            animation: slideUp .4s ease;
            max-height: 90vh;
            overflow-y: auto
        }

        @keyframes slideUp {
            from {
                transform: translateY(40px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        /* Player */
        .player-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: var(--bg3);
            flex-wrap: wrap;
            gap: 12px
        }

        .player-title {
            font-weight: 600;
            font-size: 1.1rem
        }

        .server-btns {
            display: flex;
            gap: 8px
        }

        .server-btn {
            padding: 8px 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text2);
            font-size: .85rem;
            cursor: pointer;
            transition: all var(--trans)
        }

        .server-btn:hover,
        .server-btn.active {
            background: var(--red);
            border-color: var(--red);
            color: #fff
        }

        .player-frame {
            aspect-ratio: 16/9;
            background: #000
        }

        .player-frame iframe {
            width: 100%;
            height: 100%;
            border: none
        }

        .player-controls {
            display: flex;
            gap: 12px;
            padding: 16px 20px;
            background: var(--bg3);
            flex-wrap: wrap;
            align-items: center
        }

        .ep-select {
            padding: 10px 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: .9rem;
            cursor: pointer;
            min-width: 130px
        }

        .player-actions {
            margin-left: auto;
            display: flex;
            gap: 10px
        }

        [dir="rtl"] .player-actions {
            margin-left: 0;
            margin-right: auto
        }

        /* Comments */
        .comments-section {
            padding: 20px;
            background: var(--bg2);
            border-top: 1px solid var(--border)
        }

        .comment-form {
            display: flex;
            gap: 12px;
            margin-bottom: 20px
        }

        .comment-input {
            flex: 1;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 10px 16px;
            color: var(--text);
            font-size: .9rem
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--red)
        }

        .comment-list {
            max-height: 300px;
            overflow-y: auto
        }

        .comment-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            animation: fadeIn .3s ease
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover
        }

        .comment-content {
            background: var(--bg);
            padding: 10px 14px;
            border-radius: 12px;
            flex: 1
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: .8rem
        }

        .comment-author {
            font-weight: 600;
            color: var(--text)
        }

        .comment-date {
            color: var(--text3)
        }

        .comment-text {
            font-size: .9rem;
            color: var(--text2)
        }

        /* Info Modal */
        .info-hero {
            position: relative;
            height: 350px;
            overflow: hidden
        }

        .info-hero img {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        .info-hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(transparent 30%, var(--bg2))
        }

        .info-content {
            padding: 24px;
            margin-top: -100px;
            position: relative
        }

        .info-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 12px
        }

        .info-meta {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            font-size: .95rem;
            color: var(--text2)
        }

        .info-genres {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap
        }

        .info-desc {
            color: var(--text2);
            line-height: 1.8;
            margin-bottom: 24px;
            font-size: 1rem
        }

        .info-cast {
            margin-bottom: 24px
        }

        .cast-list {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding-bottom: 8px
        }

        .cast-item {
            flex: 0 0 90px;
            text-align: center
        }

        .cast-item img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 8px;
            border: 3px solid var(--border)
        }

        .cast-item span {
            font-size: .8rem;
            color: var(--text2);
            display: block
        }

        /* Install Page */
        .install-page {
            padding: 120px 48px 80px;
            text-align: center;
            min-height: 100vh
        }

        .install-title {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #fff, var(--red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent
        }

        .install-subtitle {
            color: var(--text2);
            font-size: 1.2rem;
            margin-bottom: 50px
        }

        .install-cards {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap
        }

        .install-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px 32px;
            width: 300px;
            text-align: center;
            transition: all var(--trans)
        }

        .install-card:hover {
            transform: translateY(-10px);
            border-color: var(--red);
            box-shadow: 0 20px 50px rgba(229, 9, 20, .2)
        }

        .install-card .icon {
            font-size: 3rem;
            margin-bottom: 20px
        }

        .install-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 28px;
            background: var(--red);
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--trans)
        }

        .install-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(229, 9, 20, .4)
        }

        /* Footer */
        .footer {
            padding: 60px 48px 32px;
            background: var(--bg2);
            border-top: 1px solid var(--border)
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 32px
        }

        .footer-brand {
            max-width: 320px
        }

        .footer-brand p {
            color: var(--text2);
            font-size: .95rem;
            margin-top: 16px;
            line-height: 1.7
        }

        .footer-links {
            display: flex;
            gap: 60px
        }

        .footer-col h4 {
            font-size: .8rem;
            color: var(--text3);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 16px
        }

        .footer-col a {
            display: block;
            color: var(--text2);
            font-size: .95rem;
            margin-bottom: 12px;
            transition: color var(--trans)
        }

        .footer-col a:hover {
            color: var(--red)
        }

        .footer-bottom {
            text-align: center;
            padding-top: 32px;
            border-top: 1px solid var(--border)
        }

        .footer-bottom strong {
            color: var(--red);
            font-weight: 600
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000
        }

        .toast {
            padding: 14px 24px;
            background: var(--card);
            border-left: 4px solid var(--green);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, .5);
            animation: toastIn .4s ease
        }

        @keyframes toastIn {
            from {
                transform: translateY(30px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        .toast.error {
            border-color: var(--red)
        }

        /* Mobile */
        @media(max-width:768px) {
            .header {
                padding: 12px 20px;
                gap: 20px
            }

            .nav {
                display: none
            }

            .search-box input {
                width: 120px
            }

            .search-box:focus-within input {
                width: 180px
            }

            .hero {
                height: 70vh;
                min-height: 500px
            }

            .hero-content {
                left: 20px;
                right: 20px;
                bottom: 15%
            }

            .main {
                padding: 0 20px 60px
            }

            .card {
                flex: 0 0 150px
            }

            .wide-card {
                flex: 0 0 260px
            }

            .install-page {
                padding: 100px 20px 60px
            }

            .footer {
                padding: 40px 20px 24px
            }

            .footer-links {
                gap: 32px
            }
        }
    </style>
</head>

<body>
    <header class="header" id="header">
        <a class="logo" href="#"><span class="logo-icon">üé¨</span> Flixaro</a>
        <nav class="nav">
            <a href="#" class="active" data-page="home" data-lang="home">Home</a>
            <a href="#" data-page="movies" data-lang="movies">Movies</a>
            <a href="#" data-page="tv" data-lang="tv">TV Shows</a>
            <a href="#" data-page="anime" data-lang="anime">Anime</a>
            <a href="#" data-page="list" data-lang="list">My List</a>
            <a href="#" data-page="install" data-lang="install">Install</a>
        </nav>
        <div class="header-right">
            <div class="search-wrapper">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="Search..." data-lang-placeholder="search">
                </div>
                <div class="search-results" id="searchResults"></div>
            </div>
            <button class="icon-btn" id="langBtn" title="Language">üåê</button>
            <div style="position:relative">
                <div class="user-btn" id="userBtn">üë§</div>
                <div class="user-menu" id="userMenu">
                    <div class="user-menu-header" id="userInfo" style="display:none">
                        <h4 id="userName">User</h4>
                        <p id="userEmail">email@example.com</p>
                    </div>
                    <a class="user-menu-item" id="loginBtn" href="login.html">üîë Login</a>
                    <a class="user-menu-item" id="registerBtn" href="register.html">üìù Register</a>
                    <div class="user-menu-item" id="profileBtn" style="display:none">üë§ Profile</div>
                    <div class="user-menu-item logout" id="logoutBtn" style="display:none">üö™ Logout</div>
                </div>
            </div>
        </div>
    </header>
    <section class="hero" id="hero">
        <div class="hero-bg" id="heroBg"></div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <div class="hero-badge">üî• Trending Now</div>
            <h1 class="hero-title" id="heroTitle">Loading...</h1>
            <div class="hero-meta">
                <div class="hero-rating"><span>‚≠ê</span> <span id="heroRating">0</span></div>
                <span class="meta-tag" id="heroYear">2024</span>
                <span class="meta-tag" id="heroDuration">Movie</span>
            </div>
            <div class="hero-genres" id="heroGenres"></div>
            <p class="hero-desc" id="heroDesc">Loading...</p>
            <div class="hero-btns">
                <button class="btn btn-primary" id="heroPlay">‚ñ∂Ô∏è Play Now</button>
                <button class="btn btn-secondary" id="heroInfo">‚ÑπÔ∏è More Info</button>
                <button class="btn btn-icon" id="heroFav" title="Add to List">‚ûï</button>
            </div>
        </div>
        <div class="hero-dots" id="heroDots"></div>
    </section>
    <main class="main" id="mainContent">
        <section class="section" id="continueSection" style="display:none">
            <div class="section-header">
                <h2 class="section-title"><span class="emoji">‚ñ∂Ô∏è</span> Continue Watching</h2>
            </div>
            <div class="row" id="continueRow"></div>
        </section>
        <section class="section" id="aiSection" style="display:none">
            <div class="section-header">
                <h2 class="section-title"><span class="emoji">ü§ñ</span> Recommended for You</h2>
            </div>
            <div class="row" id="aiRow"></div>
        </section>
        <section class="section">
            <div class="section-header">
                <h2 class="section-title"><span class="emoji">üî•</span> Trending Now</h2>
            </div>
            <div class="row" id="trendingRow">
                <div class="skeleton" style="width:200px;height:300px"></div>
            </div>
        </section>
        <section class="section">
            <div class="section-header">
                <h2 class="section-title"><span class="emoji">üé¨</span> Popular Movies</h2>
            </div>
            <div class="row" id="moviesRow">
                <div class="skeleton" style="width:200px;height:300px"></div>
            </div>
        </section>
        <section class="section">
            <div class="section-header">
                <h2 class="section-title"><span class="emoji">üì∫</span> TV Shows</h2>
            </div>
            <div class="row" id="tvRow">
                <div class="skeleton" style="width:200px;height:300px"></div>
            </div>
        </section>
        <section class="section">
            <div class="section-header">
                <h2 class="section-title"><span class="emoji">üéå</span> Anime</h2>
            </div>
            <div class="row" id="animeRow">
                <div class="skeleton" style="width:200px;height:300px"></div>
            </div>
        </section>
        <section class="section" id="favSection" style="display:none">
            <div class="section-header">
                <h2 class="section-title"><span class="emoji">‚ù§Ô∏è</span> My Favorites</h2>
            </div>
            <div class="row" id="favRow"></div>
        </section>
    </main>
    <section class="install-page" id="installPage" style="display:none">
        <h1 class="install-title">üì¶ Install Flixaro</h1>
        <p class="install-subtitle">Get Flixaro on all your devices</p>
        <div class="install-cards">
            <div class="install-card">
                <div class="icon">üñ•Ô∏è</div>
                <h3>Windows</h3>
                <p>Download the desktop app for Windows 10 and 11</p>
                <div class="install-btn" id="installPwaBtn">Install App</div>
            </div>
            <div class="install-card">
                <div class="icon">üì±</div>
                <h3>Android</h3>
                <p>Get the mobile app for Android phones and tablets</p>
                <div class="install-btn" onclick="pwaInstall()">Install APK</div>
            </div>
        </div>
    </section>
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">
                <a class="logo" href="#"><span class="logo-icon">üé¨</span> Flixaro</a>
                <p>Your premium streaming destination for movies, TV shows, and anime. Enjoy unlimited entertainment.
                </p>
            </div>
            <div class="footer-links">
                <div class="footer-col">
                    <h4>Browse</h4><a href="#">Movies</a><a href="#">TV Shows</a><a href="#">Anime</a>
                </div>
                <div class="footer-col">
                    <h4>Help</h4><a href="#">FAQ</a><a href="#">Contact</a><a href="#">Support</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p><strong>Created by Ahmed Jaballah</strong></p>
            <p style="margin-top:8px">Flixaro ¬© 2026 All rights reserved</p>
        </div>
    </footer>
    <div class="modal" id="playerModal">
        <button class="modal-close" id="closePlayer">‚úï</button>
        <div class="modal-box">
            <div class="player-header">
                <span class="player-title" id="playerTitle">Now Playing</span>
                <div class="server-btns">
                    <button class="server-btn active" data-server="vidking">VidKing</button>
                    <button class="server-btn" data-server="vidsrc">VidSrc</button>
                    <button class="server-btn" data-server="embed">MultiEmbed</button>
                    <button class="server-btn" id="watchPartyBtn"
                        style="background:var(--purple);border-color:var(--purple);color:#fff">üéâ Watch Party</button>
                </div>
            </div>
            <div class="player-frame"><iframe id="playerFrame" allowfullscreen
                    sandbox="allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation"></iframe>
            </div>
            <div class="player-controls" id="epControls" style="display:none">
                <select class="ep-select" id="seasonSelect"></select>
                <select class="ep-select" id="epSelect"></select>
                <div class="player-actions">
                    <button class="btn btn-secondary" id="addFavBtn">‚ù§Ô∏è Favorite</button>
                </div>
            </div>
            <div class="comments-section">
                <h3>Comments</h3>
                <div class="comment-form">
                    <input type="text" class="comment-input" id="commentInput" placeholder="Add a comment...">
                    <button class="btn btn-primary" id="postComment">Post</button>
                </div>
                <div class="comment-list" id="commentList"></div>
            </div>
        </div>
    </div>
    <div class="modal" id="infoModal">
        <button class="modal-close" id="closeInfo">‚úï</button>
        <div class="modal-box">
            <div class="info-hero"><img id="infoBg" src="" alt=""></div>
            <div class="info-content">
                <h2 class="info-title" id="infoTitle">Title</h2>
                <div class="info-meta">
                    <span id="infoRating">‚≠ê 0</span>
                    <span id="infoYear">2024</span>
                    <span id="infoDuration">2h</span>
                </div>
                <div class="info-genres" id="infoGenres"></div>
                <p class="info-desc" id="infoDesc">Description</p>
                <div class="info-cast">
                    <h4>Cast</h4>
                    <div class="cast-list" id="infoCast"></div>
                </div>
                <div class="info-btns">
                    <button class="btn btn-primary" id="infoPlay">‚ñ∂Ô∏è Play Now</button>
                    <button class="btn btn-secondary" id="infoFav">‚ù§Ô∏è Add to Favorites</button>
                </div>
            </div>
        </div>
    </div>
    <div class="toast-container" id="toastContainer"></div>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyDdaQ6LIYJ4Zrr9llcvBcXcR95t0-i9ZLU", authDomain: "study-buddy-af784.firebaseapp.com", databaseURL: "https://study-buddy-af784-default-rtdb.firebaseio.com", projectId: "study-buddy-af784", storageBucket: "study-buddy-af784.firebasestorage.app", messagingSenderId: "734404517699", appId: "1:734404717699:web:0f3bb434118a30caf5d9f6" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(), db = firebase.database();
        const API_KEY = '6c180365d9ca8418c08865bdd62f4b60', API = 'https://api.themoviedb.org/3', IMG = 'https://image.tmdb.org/t/p';
        const SERVERS = { vidking: (t, id, s, e) => t === 'tv' ? `https://vidking.net/embed/tv/${id}/${s}/${e}` : `https://vidking.net/embed/movie/${id}`, vidsrc: (t, id, s, e) => t === 'tv' ? `https://vidsrc.cc/v2/embed/tv/${id}/${s}/${e}` : `https://vidsrc.cc/v2/embed/movie/${id}`, embed: (t, id, s, e) => t === 'tv' ? `https://multiembed.mov/?video_id=${id}&tmdb=1&s=${s}&e=${e}` : `https://multiembed.mov/?video_id=${id}&tmdb=1` };
        const GENRES = { 28: 'Action', 12: 'Adventure', 16: 'Animation', 35: 'Comedy', 80: 'Crime', 99: 'Documentary', 18: 'Drama', 10751: 'Family', 14: 'Fantasy', 36: 'History', 27: 'Horror', 10402: 'Music', 9648: 'Mystery', 10749: 'Romance', 878: 'Sci-Fi', 53: 'Thriller', 10752: 'War', 37: 'Western' };
        const LANG = { en: { home: 'Home', movies: 'Movies', tv: 'TV Shows', anime: 'Anime', list: 'My List', install: 'Install', search: 'Search movies, shows...', login: 'Login', register: 'Register', logout: 'Logout', profile: 'Profile' }, ar: { home: 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©', movies: 'ÿ£ŸÅŸÑÿßŸÖ', tv: 'ŸÖÿ≥ŸÑÿ≥ŸÑÿßÿ™', anime: 'ÿ£ŸÜŸäŸÖŸä', list: 'ŸÇÿßÿ¶ŸÖÿ™Ÿä', install: 'ÿ™ÿ´ÿ®Ÿäÿ™', search: 'ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£ŸÅŸÑÿßŸÖ...', login: 'ÿØÿÆŸàŸÑ', register: 'ÿ™ÿ≥ÿ¨ŸäŸÑ', logout: 'ÿÆÿ±Ÿàÿ¨', profile: 'ÿ≠ÿ≥ÿßÿ®Ÿä' } };
        let currentMedia = null, currentServer = 'vidking', season = 1, episode = 1, user = null, favorites = [], history = [], heroItems = [], heroIndex = 0, deferredPrompt, currentLang = 'en';
        const $ = id => document.getElementById(id), $$ = s => document.querySelectorAll(s);
        function toast(msg, err = false) { const t = document.createElement('div'); t.className = `toast ${err ? 'error' : ''}`; t.innerHTML = `${err ? '‚ùå' : '‚úÖ'} ${msg}`; $('toastContainer').appendChild(t); setTimeout(() => t.remove(), 3000) }
        function debounce(fn, d) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), d) } }
        async function fetchAPI(ep, p = {}) { const url = new URL(`${API}${ep}`); url.searchParams.set('api_key', API_KEY); Object.entries(p).forEach(([k, v]) => url.searchParams.set(k, v)); try { const r = await fetch(url); if (!r.ok) throw 0; return await r.json() } catch (e) { return null } }
        function createCard(item, wide = false) {
            const type = item.media_type || (item.first_air_date ? 'tv' : 'movie'), title = item.title || item.name, year = (item.release_date || item.first_air_date || '').split('-')[0], rating = item.vote_average?.toFixed(1) || 'N/A', poster = item.poster_path ? `${IMG}/w342${item.poster_path}` : null, backdrop = item.backdrop_path ? `${IMG}/w780${item.backdrop_path}` : poster, isAnime = item.genre_ids?.includes(16) && item.origin_country?.includes('JP');
            if (wide) { const d = document.createElement('div'); d.className = 'wide-card'; d.innerHTML = `<img src="${backdrop || 'https://via.placeholder.com/320x180?text=No+Image'}" alt="${title}" loading="lazy"><div class="play-btn">‚ñ∂Ô∏è</div><div class="progress"><div class="progress-bar" style="width:${item.progress || 30}%"></div></div>`; d.onclick = () => openPlayer(item); return d }
            const c = document.createElement('div'); c.className = 'card'; c.innerHTML = `<div class="card-img">${poster ? `<img src="${poster}" alt="${title}" loading="lazy">` : '<div style="width:100%;height:100%;background:var(--bg3)"></div>'}<div class="card-overlay"><div class="card-play">‚ñ∂Ô∏è</div></div><div class="card-rating"><span class="star">‚≠ê</span>${rating}</div>${type === 'tv' ? `<div class="card-badge${isAnime ? ' anime' : ''}">TV</div>` : isAnime ? '<div class="card-badge anime">ANIME</div>' : ''}</div><div class="card-info"><div class="card-title">${title}</div><div class="card-meta"><span>${year}</span></div></div>`;
            c.onclick = () => openInfo(item); return c
        }
        function renderRow(el, items, wide = false) { el.innerHTML = ''; items.forEach(i => el.appendChild(createCard(i, wide))) }
        function renderHero() { if (!heroItems.length) return; const item = heroItems[heroIndex]; $('heroBg').innerHTML = `<div class="hero-slide active"><img src="${IMG}/original${item.backdrop_path}" alt=""></div>`; $('heroTitle').textContent = item.title || item.name; $('heroRating').textContent = item.vote_average?.toFixed(1); $('heroYear').textContent = (item.release_date || item.first_air_date || '').split('-')[0]; $('heroDuration').textContent = item.media_type === 'tv' ? 'TV Series' : 'Movie'; $('heroGenres').innerHTML = (item.genre_ids || []).slice(0, 3).map(g => `<span class="genre-tag">${GENRES[g] || ''}</span>`).join(''); $('heroDesc').textContent = item.overview || ''; $('heroPlay').onclick = () => openPlayer(item); $('heroInfo').onclick = () => openInfo(item); $('heroFav').onclick = () => toggleFav(item); $('heroDots').innerHTML = heroItems.slice(0, 5).map((_, i) => `<div class="hero-dot${i === heroIndex ? ' active' : ''}" data-i="${i}"></div>`).join(''); $$('.hero-dot').forEach(d => d.onclick = () => { heroIndex = +d.dataset.i; renderHero() }) }
        async function openPlayer(item) { const type = item.media_type || (item.first_air_date ? 'tv' : 'movie'); currentMedia = { ...item, mediaType: type }; season = item.s || 1; episode = item.e || 1; $('playerTitle').textContent = item.title || item.name; if (type === 'tv') { const d = await fetchAPI(`/tv/${item.id}`); if (d) renderSeasons(d); $('epControls').style.display = 'flex' } else { $('epControls').style.display = 'none' } updatePlayer(); $('playerModal').classList.add('active'); document.body.style.overflow = 'hidden'; addHistory(item); loadComments(item.id) }
        function renderSeasons(d) { const ss = $('seasonSelect'), es = $('epSelect'); ss.innerHTML = d.seasons.filter(s => s.season_number > 0).map(s => `<option value="${s.season_number}"${s.season_number === season ? ' selected' : ''}>Season ${s.season_number}</option>`).join(''); ss.onchange = async () => { season = +ss.value; const sd = await fetchAPI(`/tv/${currentMedia.id}/season/${season}`); if (sd?.episodes) { es.innerHTML = sd.episodes.map(e => `<option value="${e.episode_number}">Episode ${e.episode_number}</option>`).join(''); episode = 1; updatePlayer() } }; es.onchange = () => { episode = +es.value; updatePlayer() }; ss.dispatchEvent(new Event('change')) }
        function updatePlayer() { if (!currentMedia) return; $('playerFrame').src = SERVERS[currentServer](currentMedia.mediaType, currentMedia.id, season, episode) }
        function closePlayer() { $('playerModal').classList.remove('active'); $('playerFrame').src = ''; document.body.style.overflow = '' }
        async function openInfo(item) { const type = item.media_type || (item.first_air_date ? 'tv' : 'movie'), id = item.id; const d = await fetchAPI(`/${type}/${id}`, { append_to_response: 'credits' }); if (!d) return; currentMedia = { ...d, mediaType: type }; $('infoBg').src = d.backdrop_path ? `${IMG}/original${d.backdrop_path}` : ''; $('infoTitle').textContent = d.title || d.name; $('infoRating').textContent = `‚≠ê ${d.vote_average?.toFixed(1)}`; $('infoYear').textContent = (d.release_date || d.first_air_date || '').split('-')[0]; $('infoDuration').textContent = d.runtime ? `${d.runtime} min` : d.number_of_seasons ? `${d.number_of_seasons} Seasons` : ''; $('infoGenres').innerHTML = (d.genres || []).map(g => `<span class="genre-tag">${g.name}</span>`).join(''); $('infoDesc').textContent = d.overview || 'No description available.'; $('infoCast').innerHTML = (d.credits?.cast || []).slice(0, 8).map(c => `<div class="cast-item"><img src="${c.profile_path ? IMG + '/w185' + c.profile_path : 'https://via.placeholder.com/70x70?text=üë§'}" alt="${c.name}"><span>${c.name}</span></div>`).join(''); $('infoPlay').onclick = () => { closeInfo(); openPlayer(d) }; $('infoFav').onclick = () => toggleFav(d); $('infoModal').classList.add('active'); document.body.style.overflow = 'hidden' }
        function closeInfo() { $('infoModal').classList.remove('active'); document.body.style.overflow = '' }
        function toggleFav(item) { if (!user) { toast('Login to add favorites', 'error'); return } const id = item.id; if (favorites.some(f => f.id === id)) { favorites = favorites.filter(f => f.id !== id); db.ref(`users/${user.uid}/favorites/${id}`).remove(); toast('Removed', 'error') } else { const f = { id, title: item.title || item.name, poster_path: item.poster_path, backdrop_path: item.backdrop_path, media_type: item.media_type || (item.first_air_date ? 'tv' : 'movie') }; favorites.push(f); db.ref(`users/${user.uid}/favorites/${id}`).set(f); toast('Added!') } renderFavorites() }
        function addHistory(item) { if (!user) return; const h = { id: item.id, title: item.title || item.name, backdrop_path: item.backdrop_path, media_type: item.media, progress: Math.floor(Math.random() * 60) + 20, time: Date.now() }; db.ref(`users/${user.uid}/history/${item.id}`).set(h); history = history.filter(x => x.id !== item.id); history.unshift(h); renderHistory(); getAIRecommendations(item.genre_ids) }
        function getAIRecommendations(gIds) { if (!gIds?.length) return; fetchAPI('/discover/movie', { with_genres: gIds.join(','), sort_by: 'popularity.desc' }).then(d => { if (d?.results) { $('aiSection').style.display = 'block'; renderRow($('aiRow'), d.results) } }) }
        function renderFavorites() { if (!favorites.length) { $('favSection').style.display = 'none'; return } $('favSection').style.display = 'block'; renderRow($('favRow'), favorites) }
        function renderHistory() { if (!history.length) { $('continueSection').style.display = 'none'; return } $('continueSection').style.display = 'block'; renderRow($('continueRow'), history.slice(0, 10), true) }
        async function search(q) { if (!q.trim()) { $('searchResults').classList.remove('active'); return } const d = await fetchAPI('/search/multi', { query: q }); const results = (d?.results || []).filter(r => r.media_type !== 'person' && (r.poster_path || r.backdrop_path)).slice(0, 8); $('searchResults').innerHTML = results.map(r => `<div class="search-item" onclick="openInfoWrapper(${r.id},'${r.media_type}')"><img src="${IMG}/w92${r.poster_path || r.backdrop_path}"><div class="search-item-info"><h4>${r.title || r.name}</h4><p>${(r.release_date || r.first_air_date || '').split('-')[0]}</p></div></div>`).join(''); $('searchResults').classList.add('active') }
        window.openInfoWrapper = (id, type) => { fetchAPI(`/${type}/${id}`).then(d => { if (d) openInfo({ ...d, media_type: type }) }); $('searchResults').classList.remove('active') }
        function loadComments(id) { const list = $('commentList'); list.innerHTML = ''; db.ref(`comments/${id}`).limitToLast(10).on('child_added', s => { const c = s.val(); const el = document.createElement('div'); el.className = 'comment-item'; el.innerHTML = `<img src="https://ui-avatars.com/api/?name=${c.author}&background=random" class="comment-avatar"><div class="comment-content"><div class="comment-header"><span class="comment-author">${c.author}</span><span class="comment-date">${new Date(c.time).toLocaleDateString()}</span></div><div class="comment-text">${c.text}</div></div>`; list.prepend(el) }) }
        $('postComment').onclick = () => { if (!user) { toast('Login to comment', 'error'); return } const txt = $('commentInput').value.trim(); if (!txt) return; db.ref(`comments/${currentMedia.id}`).push({ author: user.displayName || 'User', text: txt, time: Date.now() }); $('commentInput').value = '' }
        $('watchPartyBtn').onclick = () => { if (!user) return; const partyId = Math.random().toString(36).substr(2, 9); prompt('Share this Party ID:', partyId); db.ref(`party/${partyId}`).set({ media: currentMedia, time: 0, playing: true }) }
        $('langBtn').onclick = () => { currentLang = currentLang === 'en' ? 'ar' : 'en'; document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr'; $$('[data-lang]').forEach(el => el.textContent = LANG[currentLang][el.dataset.lang]); $('searchInput').placeholder = LANG[currentLang].search }
        window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; $('installPage').style.display = 'block' });
        $('installPwaBtn').onclick = async () => { if (deferredPrompt) { deferredPrompt.prompt(); const { outcome } = await deferredPrompt.userChoice; if (outcome === 'accepted') deferredPrompt = null } };
        auth.onAuthStateChanged(u => { user = u; if (u) { $('userInfo').style.display = 'block'; $('userName').textContent = u.displayName; $('loginBtn').style.display = 'none'; $('registerBtn').style.display = 'none'; $('logoutBtn').style.display = 'block'; loadUserData() } else { $('userInfo').style.display = 'none'; $('loginBtn').style.display = 'block'; loadUserData() } });
        async function loadUserData() { if (!user) { favorites = []; history = []; renderFavorites(); renderHistory(); return } const f = await db.ref(`users/${user.uid}/favorites`).once('value'); favorites = Object.values(f.val() || {}); renderFavorites() }
        async function init() { if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js'); const [tr, mv, tp, tv, an] = await Promise.all([fetchAPI('/trending/all/week'), fetchAPI('/movie/popular'), fetchAPI('/movie/top_rated'), fetchAPI('/tv/popular'), fetchAPI('/discover/tv', { with_genres: 16, with_origin_country: 'JP' })]); heroItems = (tr?.results || []).slice(0, 5); renderHero(); renderRow($('trendingRow'), tr?.results || []); renderRow($('moviesRow'), mv?.results || []); renderRow($('animeRow'), (an?.results || []).map(x => ({ ...x, media_type: 'tv' }))) }
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>